<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶∏‡ßç‡¶§‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>

<style>
    body{
        font-family: Arial;
        padding: 10px;
        background:#f4f4f4;
    }
  .container{max-width:1000px;margin:18px auto;padding:16px}
  
    h1{
        text-align:center;
        margin-bottom:20px;
    }

    .top-buttons{
        display:flex;
        gap:10px;
        margin-bottom:20px;
    }
    button{
        padding:10px 20px;
        background:#3498db;
        color:#fff;
        border:none;
        border-radius:5px;
        cursor:pointer;
        font-size:16px;
    }
    button:hover{
        background:#2980b9;
    }

    .search-bar{
        width:100%;
        padding:10px;
        margin-bottom:20px;
        font-size:16px;
    }

    table{
        width:100%;
        border-collapse: collapse;
        background:white;
    }
    th, td{
        border:1px solid #ddd;
        padding:10px;
        text-align:left;
    }
    th{
        background:#3498db;
        color:white;
    }

    .hidden {
        display:none;
    }
</style>
</head>

<body>

<h1>‡¶¨‡¶∏‡ßç‡¶§‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶∏‡ßá‡¶¨‡¶æ ‚Äî ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>

<!-- TOP BUTTONS -->
<div class="top-buttons">
    <button onclick="showTotalDonation()">Total Donation</button>
    <button onclick="showAddressCount()">Address</button>
    <button onclick="showCategoryCount()">Category</button>
</div>

<!-- SEARCH BAR -->
<input type="text" id="searchBox" class="search-bar" placeholder=" ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶" onkeyup="searchTable()">

<!-- DATA TABLE -->
<table id="dataTable">
    <thead>
        <tr>
            <th>TimeStamp</th>
            <th>Name</th>
            <th>Address</th>
            <th>Whatsapp</th>
            <th>Category</th>
            <th>Code</th>
            <th>Description</th>
            <th>Image</th>
        </tr>
    </thead>
    <tbody id="tableBody"></tbody>
</table>


<script>
// üü¶ Google Sheet ‚Üí OpenSheet API URL
const sheetURL = "https://opensheet.elk.sh/1r3x6Mt1zPoz4PXmlB25R5qfzLmpO0XJU3MAIGg7MdeE/Sheet1";

// üü¶ Load Data
fetch(sheetURL)
.then(res => res.json())
.then(data => {
    loadTable(data);
    window.dataset = data;   // store for button stats
});

// üü¶ Load data into table
function loadTable(data){
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";

    data.forEach(row => {
        let tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${row.TimeStamp}</td>
            <td>${row.Pname}</td>
            <td>${row.Address}</td>

            <td><a href="https://wa.me/${row.Whatsapp}" target="_blank">${row.Whatsapp}</a></td>

            <td>${row.Category}</td>
            <td>${row.Code}</td>

            <td>
                <button onclick="alert('${row.Description.replace(/'/g, "\\'")}')">Show</button>
            </td>

            <td>
                <button onclick="window.open('${row.Image}', '_blank')">View</button>
            </td>
        `;

        tbody.appendChild(tr);
    });
}


// üü¶ Search Function
function searchTable(){
    let filter = document.getElementById("searchBox").value.toLowerCase();
    let trs = document.getElementById("dataTable").getElementsByTagName("tr");

    for(let i=1; i<trs.length; i++){
        let rowText = trs[i].innerText.toLowerCase();
        trs[i].style.display = rowText.includes(filter) ? "" : "none";
    }
}


// üü¶ Total Donation Count
function showTotalDonation(){
    alert("Total Donar: " + window.dataset.length);
}


// üü¶ Address Count
function showAddressCount(){
    let count = {};

    window.dataset.forEach(d => {
        if(!count[d.Address]) count[d.Address] = 0;
        count[d.Address]++;
    });

    let msg = "Address count:\n\n";
    for(let a in count){
        msg += `${a}: ${count[a]} donor\n`;
    }

    alert(msg);
}


// üü¶ Category Count
function showCategoryCount(){
    let count = {};

    window.dataset.forEach(d => {
        if(!count[d.Category]) count[d.Category] = 0;
        count[d.Category]++;
    });

    let msg = "Category count :\n\n";
    for(let c in count){
        msg += `${c}: ${count[c]} donar\n`;
    }

    alert(msg);
}

</script>

</body>
</html>
